# SD Meta Inspector

Extract Stable Diffusion generation metadata (prompts, seed, steps, sampler settings, etc.) from images.  
Supports **PNG** and **JPEG** generated by **Automatic1111**, **ComfyUI**, **InvokeAI**, or other UIs that embed prompts and parameters.

This project provides **two apps**:
- A **console CLI tool** (`sd_meta_extract.py`)
- A **graphical GUI tool** (`sd_meta_extract_gui.py`)

---

## Features

### General
- Extracts metadata blocks from:
  - PNG text chunks (`parameters`, `prompt`, `sd-metadata`, `Software`)
  - JPEG EXIF fields and JPEG comments
- Parses Automatic1111 parameter strings into structured JSON (prompt, negative prompt, seed, steps, cfg, sampler, size…)
- Detects ComfyUI JSON prompts
- Can attempt to rebuild metadata for a JPEG by checking for a sibling PNG
- Writes extracted metadata to a `.json` sidecar file

### CLI (`sd_meta_extract.py`)
- Processes single images or entire directories
- Outputs human-friendly summaries and full JSON sidecar files
- Options to disable sidecar writing, limit prompt preview length, etc.

### GUI (`sd_meta_extract_gui.py`)
- Drag & drop images or open via file dialog
- Side-by-side: image preview + extracted metadata
- Buttons:
  - **Load** — open an image
  - **Export JSON** — saves a `.json` sidecar next to the image
  - **Copy Prompt to Clipboard** — copies just the prompt text (or ComfyUI JSON if that’s all there is)
- Zoom controls:
  - Ctrl + Mouse Wheel zoom
  - + / – buttons
  - Zoom combo box (25–400%)
- Settings are persisted automatically in `~/.sd_meta_inspector.json`:
  - Default zoom level (default: 50%)
  - Whether to rebuild JPEG metadata from a sibling PNG
  - Last-used directory

---

## Installation

### Requirements
- Python 3.9+
- [Pillow](https://pypi.org/project/Pillow/)  
- [PyQt6](https://pypi.org/project/PyQt6/) (GUI only)

Install dependencies:

```bash
pip install -r requirements.txt
```

---

## Usage

### Console
```bash
# Single image
python sd_meta_extract.py image.png

# Whole directory
python sd_meta_extract.py ./images/

# Disable sidecar output
python sd_meta_extract.py --no-sidecar image.png
```

Output:
```
my_zombie.png [PNG,512x768] | seed 12345 | steps 30 | cfg 7.5 | model sd-v1-5-pruned.ckpt
A grotesque, slimy zombie lurches through the city...
```

### GUI
```bash
python sd_meta_extract_gui.py
```

- Drag & drop a `.png` or `.jpg` onto the window, or use **Load**.
- Use **Export JSON** to write a sidecar file.
- Use **Copy Prompt to Clipboard** to grab just the prompt text.

---

## Config File

The GUI saves its settings to:

```
~/.sd_meta_inspector.json
```

Example:
```json
{
  "default_zoom": 50,
  "rebuild_jpeg_from_png": false,
  "last_dir": "/home/user/images"
}
```

---

## Example Sidecar Output

For `zombie.png`:

```json
{
  "prompt": "A grotesque, slimy zombie lurches through the city",
  "negative_prompt": "low quality, blurry",
  "steps": 30,
  "seed": 12345,
  "cfg_scale": 7.5,
  "sampler": "Euler a",
  "_file": "zombie.png",
  "_format": "PNG",
  "_size": {
    "width": 512,
    "height": 768
  }
}
```

---

## License
MIT License. Do what you want, but attribution is appreciated.
